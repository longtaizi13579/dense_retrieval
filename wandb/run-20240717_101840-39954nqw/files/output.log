/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/torch/_utils.py:776: UserWarning: TypedStorage is deprecated. It will be removed in the future and UntypedStorage will be the only storage class. This should only matter to you if you are using storages directly.  To access UntypedStorage directly, use tensor.untyped_storage() instead of tensor.storage()
  return self.fget.__get__(instance, owner)()

































































Inference Embeddings: 100%|███████████████████████████████████████████████████████████████████████████| 3253/3253 [02:33<00:00, 21.25it/s]












Inference Embeddings: 100%|███████████████████████████████████████████████████████████████████████████████| 85/85 [00:24<00:00,  3.48it/s]
























































































































































































































































































































































































































































































































































































100%|████████████████████████████████████████████████████████████████████████████████████████████| 832751/832751 [19:08<00:00, 725.10it/s]
Setting TOKENIZERS_PARALLELISM=false for forked processes.





Map (num_proc=8):   0%|                                                                                 | 0/832751 [05:56<?, ? examples/s]
multiprocess.pool.RemoteTraceback:
"""
Traceback (most recent call last):
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/transformers/tokenization_utils_base.py", line 270, in __getattr__
    return self.data[item]
KeyError: 'cuda'
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/pool.py", line 125, in worker
    result = (True, func(*args, **kwds))
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/utils/py_utils.py", line 678, in _write_generator_to_queue
    for i, result in enumerate(func(**kwargs)):
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/arrow_dataset.py", line 3552, in _map_single
    batch = apply_function_on_filtered_inputs(
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/arrow_dataset.py", line 3421, in apply_function_on_filtered_inputs
    processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
  File "retriever_training.py", line 110, in tokenize
    inputs_querys_ids = tokenizer(
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/transformers/tokenization_utils_base.py", line 272, in __getattr__
    raise AttributeError
AttributeError
"""
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/arrow_dataset.py", line 3253, in map
    for rank, done, content in iflatmap_unordered(
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/utils/py_utils.py", line 718, in iflatmap_unordered
    [async_result.get(timeout=0.05) for async_result in async_results]
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/utils/py_utils.py", line 718, in <listcomp>
    [async_result.get(timeout=0.05) for async_result in async_results]
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/pool.py", line 771, in get
    raise self._value
AttributeError
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "retriever_training.py", line 189, in <module>
    data_loader = build_train_data(data_args.file_path, model_args.model_name_or_path, tokenizer, identifiers_index, name_to_identifiers_id, all_candidates, data_args)
  File "retriever_training.py", line 137, in build_train_data
    encode_ds = dataset.map(tokenize, batched=True, batch_size=training_args.train_batch_size, num_proc=8)
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/arrow_dataset.py", line 602, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/arrow_dataset.py", line 567, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/datasets/arrow_dataset.py", line 3261, in map
    pbar.update(content)
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/pool.py", line 736, in __exit__
    self.terminate()
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/pool.py", line 654, in terminate
    self._terminate()
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/util.py", line 224, in __call__
    res = self._callback(*self._args, **self._kwargs)
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/pool.py", line 692, in _terminate_pool
    cls._help_stuff_finish(inqueue, task_handler, len(pool))
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/pool.py", line 674, in _help_stuff_finish
    inqueue._reader.recv()
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/multiprocess/connection.py", line 254, in recv
    return _ForkingPickler.loads(buf.getbuffer())
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/dill/_dill.py", line 303, in loads
    return load(file, ignore, **kwds)
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/dill/_dill.py", line 289, in load
    return Unpickler(file, ignore=ignore, **kwds).load()
  File "/home/yeqin/anaconda3/envs/retriever/lib/python3.8/site-packages/dill/_dill.py", line 444, in load
    obj = StockUnpickler.load(self)
EOFError: Ran out of input